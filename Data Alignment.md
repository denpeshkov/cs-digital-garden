---
tags:
  - OS
  - Architecture
  - C
---

# Alignment Requirement

The CPU accesses [memory](Random%20Access%20Memory.md) by a single **memory word at a time**. As long as the memory word size is at least as large as the largest primitive data type supported by the computer, aligned accesses will always access a single memory word. This may not be true for misaligned data accesses

To improve memory efficiency data has to be aligned: primitive object of $K$ bytes must have an address that is a multiple of $K$

Without alignment, two memory accesses are needed to fetch single primitive object split across two memory blocks

`x86-64` works regardless of the alignment of data, some others architectures don't

# Satisfying Alignment Requirements

Alignment is enforced by making sure that every data type is organized and allocated in such a way that every object within the type satisfies its alignment restrictions

- Initial address of the object (e.g. struct) must be aligned. Starting address for any block generated by a memory allocation function (`malloc`) must be aligned
- Every field inside object must be aligned
- Size of the object must be aligned to satisfy alignment for arrays of objects
- Stack frame may be aligned

If we have a type:

``` C
struct S {
	T1 f1
	T2 f2
	...
	Tn fn
}
```

where `Tmax` is the size of the biggest element's type `T1,…,Tn`

Compiler must ensure (by adding **paddings**) that:

- Any pointer `p` of type struct `S*` satisfies the alignment - `*p` is a multiple of `Tmax`
- Each element `fi` satisfies the alignment - `&fi` is a multiple of `Ti`
- Size of the `S` is a multiple of `Tmax`

# References

- [Data structure alignment - Wikipedia](https://en.wikipedia.org/wiki/Data_structure_alignment)
- [Computer Systems A Programmer's Perspective, Global Edition (3rd ed). Randal E. Bryant, David R. O'Hallaron](References.md#Computer%20Systems%20A%20Programmer's%20Perspective,%20Global%20Edition%20(3rd%20ed).%20Randal%20E.%20Bryant,%20David%20R.%20O'Hallaron)
- [Caltech CS24-Sp18 Introduction-To-Computing-System - YouTube](References.md#Caltech%20CS24-Sp18%20Introduction-To-Computing-System%20-%20YouTube)
- [CS24 Caltech Sp18 - YouTube](https://www.youtube.com/watch?v=CWR4wQTIlTQ&list=PL3swII2vlVoXiqUBV524pKEsP1iBN4UBU&index=7)
